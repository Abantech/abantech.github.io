<!DOCTYPE html>
<!-- saved from url=(0054)http://leapmotion.github.io/leapjs-rigged-hand/?dots=1 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Leap Rigged Hand</title>

    <style>
        body {
            margin: 0;
            font-family: Helvetica;
        }

        canvas {
            pointer-events: none;
        }

        input {
            cursor: pointer;
        }

        #connect-leap {
            bottom: 0;
            top: auto !important;
        }

        table, th, td {
            border: 1px solid #aaa;
        }

        table {
            border-collapse: collapse;
        }

        td, th {
            vertical-align: top;
            padding: 3px;
        }

        th {
            color: #555;
        }

        #view-source {
            position: absolute;
            top: 0;
            right: 0;
            margin: 10px;
        }
    </style>
    
    <!--<script src="http://code.jquery.com/jquery-2.1.1.js"></script>
    <script src="http://threejs.org/build/three.js"></script>
    <script src="http://threejs.org/examples/js/controls/orbitcontrols.js"></script>
    <script src="http://threejs.org/examples/js/detector.js"></script>
    <script src="http://threejs.org/examples/js/libs/stats.min.js"></script>

    <script src="Libs/Leap/leap-0.6.4.js"></script>
    <script src="Libs/Leap/leap-plugins-0.1.10.js"></script>
    <script src="Libs/Leap/leap.rigged-hand-0.1.6.js"></script>-->

    <!-- BEGIN internal references -->
    <script src="Libs/THREEJS/three.min.js"></script>
    <script src="Libs/THREEJS/OrbitControls.js"></script>
    <script src="Libs/THREEJS/Detector.js"></script>
    <script src="Libs/THREEJS/stats.min.js"></script>
    
    <script src="Libs/Leap/leap-0.6.4.min.js"></script>
    <script src="Libs/Leap/leap-plugins-0.1.10.min.js"></script>
    <script src="Libs/Leap/leap-plugins-0.1.10-utils.min.js"></script>
    <script src="Libs/Leap/leap-widgets-0.1.0.min.js"></script>
    <script src="Libs/Leap/leap.rigged-hand-0.1.6.js"></script>
    <!-- END internal references -->
    <script src="http://leapmotion.github.io/leapjs-widgets/src/leap.proximity.js"></script>
    
    <!-- BEGIN external references  ->-
    <script src="http://js.leapmotion.com/leap-0.6.4.js"></script>
    <script src="http://js.leapmotion.com/leap-plugins-0.1.10.js"></script>
    <script src="http://js.leapmotion.com/leap.rigged-hand-0.1.6.js"></script>
    !<-- END external references-->
</head>
<body>

    <script src="Scripts/SceneSetup.js"></script>
    <script src="Scripts/FrameActions.js"></script>
    <script src="Scripts/HandController.js"></script>
    <script src="Scripts/HandsPositionAdjustment.js"></script>
    
    <script src="Scripts/FadingSpheres.js"></script>
    <script src="Scripts/HandBasedActions/PinchLine.js"></script>
    <script src="Scripts/LeapLoopSetup.js"></script>

    <script>
        handController.RegisterAction("DrawfadingSpheres", createFadingSpheresAtFingerTips);
        //TODO: the line drawn between fingers for the pinch below but is not working yet...
        handController.RegisterAction("DrawPinchLine", drawPinchLine);
        
        window.widgets

        var newShapesButton = new THREE.Mesh(
          new THREE.SphereGeometry(window.innerWidth / 200, 16, 16),
          new THREE.MeshPhongMaterial({ wireframe: false })
        );

        newShapesButton.position.set(window.innerWidth / 12, window.innerHeight / 16, 10);

        window.scene.add(newShapesButton);

        var changeButtonColorToRed = function (hand) { 
            //if (isButtonPressed(hand, newShapesButton))
            newShapesButton.material.color.setHex(isButtonPressed(hand, newShapesButton) ? 0xff0000 : 0x0000ff);
        };

        handController.RegisterAction("ChangeButtonColorOnPress", changeButtonColorToRed);

        function isButtonPressed(hand, button) {
            var indexTipVector = (new THREE.Vector3()).fromArray(hand.fingers[0].tipPosition);
            //!?! Have to use the thumb as the other end of the ray, do not know why it's not working with the pipPosition or mcpPosition
            var indexPipVector = (new THREE.Vector3()).fromArray(hand.fingers[1].tipPosition);

            var dir = new THREE.Vector3();
            dir.subVectors(indexTipVector, indexPipVector).normalize();

            var raycaster = new THREE.Raycaster(indexPipVector, dir, 0, 200);
            
            var intersection = raycaster.intersectObject(button, true);
            if (intersection.length > 0) {
                return true;
            }
            else {
                return false;
            }
        }

        //TODO: implement theo's suggestion to keep these on the body and everything else in a full-screen iframe so that these flatland sliders would work
        createAdjuster("x", -250, 250, 0, function (value) { xTranslation = value });
        createAdjuster("y", -300, 300, -75, function (value) { yTranslation = value });
        createAdjuster("z", -1000, 150, 0, function (value) { zTranslation = value });
    </script>
</body>
</html>