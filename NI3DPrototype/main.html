<!DOCTYPE html>
<!-- saved from url=(0054)http://leapmotion.github.io/leapjs-rigged-hand/?dots=1 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>NI 3D prototype workspace</title>

    <style>
        body {
            margin: 0;
            font-family: Helvetica;
        }

        canvas {
            pointer-events: none;
        }

        input {
            cursor: pointer;
        }

        #connect-leap {
            bottom: 0;
            top: auto !important;
        }

        table, th, td {
            border: 1px solid #aaa;
        }

        table {
            border-collapse: collapse;
        }

        td, th {
            vertical-align: top;
            padding: 3px;
        }

        th {
            color: #555;
        }

        #view-source {
            position: absolute;
            top: 0;
            right: 0;
            margin: 10px;
        }
    </style>

    <!--<script src="http://code.jquery.com/jquery-2.1.1.js"></script>
    <script src="http://threejs.org/build/three.js"></script>
    <script src="http://threejs.org/examples/js/controls/orbitcontrols.js"></script>
    <script src="http://threejs.org/examples/js/detector.js"></script>
    <script src="http://threejs.org/examples/js/libs/stats.min.js"></script>

    <script src="Libs/Leap/leap-0.6.4.js"></script>
    <script src="Libs/Leap/leap-plugins-0.1.10.js"></script>
    <script src="Libs/Leap/leap.rigged-hand-0.1.6.js"></script>-->
    <!-- BEGIN internal references -->
    <script src="Libs/THREEJS/three.min.js"></script>
    <script src="Libs/THREEJS/OrbitControls.js"></script>
    <script src="Libs/THREEJS/Detector.js"></script>
    <script src="Libs/THREEJS/stats.min.js"></script>

    <script src="Libs/Leap/leap-0.6.4.min.js"></script>
    <script src="Libs/Leap/leap-plugins-0.1.10.min.js"></script>
    <script src="Libs/Leap/leap-plugins-0.1.10-utils.min.js"></script>
    <script src="Libs/Leap/leap-widgets-0.1.0.min.js"></script>
    <script src="Libs/Leap/leap.rigged-hand-0.1.6.js"></script>
    <!-- END internal references -->
    <script src="http://leapmotion.github.io/leapjs-widgets/src/leap.proximity.js"></script>

    <!-- BEGIN external references  ->-
    <script src="http://js.leapmotion.com/leap-0.6.4.js"></script>
    <script src="http://js.leapmotion.com/leap-plugins-0.1.10.js"></script>
    <script src="http://js.leapmotion.com/leap.rigged-hand-0.1.6.js"></script>
    !<-- END external references-->
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
</head>
<body>
    <h2>Move the line between the index and thumb through the sphere, hold for three quarters of a second and see a cube get created. Hold longer to make the cube rotate.</h2>
    <script src="Scripts/Utils/MathHelper.js"></script>
    <script src="Scripts/Utils/GestureTimer.js"></script>
    <script src="Scripts/Scene/SceneSetup.js"></script>
    <script src="Scripts/Scene/LEAPToSceneConverter.js"></script>
    <script src="Scripts/LeapLoopSetup.js"></script>
    <script src="Scripts/Scene/LEAPToSceneConverterInitializer.js"></script>



    <script src="Scripts/FrameActions.js"></script>
    <script src="Scripts/HandController.js"></script>
    <script src="Scripts/HandsPositionAdjustment.js"></script>

    <script src="Scripts/FadingSpheres.js"></script>
    <script src="Scripts/HandBasedActions/PinchLine.js"></script>
    <script src="Scripts/HandBasedActions/MenuButtons.js"></script>
    <script src="Scripts/HandBasedActions/PinchHandGesture.js"></script>

    <script src="Scripts/TranslationAction.js"></script>
    <script src="Scripts/ActionManager.js"></script>

    <script>
        handController.RegisterAction("DrawfadingSpheres", createFadingSpheresAtFingerTips);
        handController.RegisterAction("DrawPinchLine", drawPinchLine);
        handController.RegisterAction("ChangeButtonColorOnPress", changeButtonColorToRed);
        handController.RegisterAction("CreateBoxAfterDelay", createBoxAfterDelay);



        $(document).keypress(function (event)
        {
            var keycode = (event.keyCode ? event.keyCode : event.which);
            var keyChar = String.fromCharCode(keycode);

            if (keycode == '13')
            {
                box = createBox(40, new THREE.Vector3(0, 0, 0), 0xabcdef);
                box.isAsset = true;
                box.name = "box";
                window.scene.add(box);
            }

            if (keyChar === 'u')
            {
                actionManager.Undo();
            }

            if (keyChar === 'r')
            {
                actionManager.Redo();
            }
        });

        var pinchedObject;
        var action;
        pinchGesture.options.distance = 40;

        function getPinchedObject(hand)
        {
            var indexTipVector = (new THREE.Vector3()).fromArray(hand.fingers[0].tipPosition);

            var closestObject = null;

            for (var i = 0; i < window.scene.children.length; i++)
            {
                var sceneObject = window.scene.children[i];
                if (sceneObject.isAsset)
                {
                    var distance = mathHelper.DistanceBetweenPoints(indexTipVector, sceneObject.position);
                    if (distance < 50)
                    {
                        if (closestObject)
                        {
                            if (distance < closestObject.distance)
                            {
                                closestObject = sceneObject;
                                closestObject.distance = distance;
                            }
                        }
                        else
                        {
                            closestObject = sceneObject;
                            closestObject.distance = distance;
                        }
                    }
                }
            }

            return closestObject;
        }

        pinchGesture.registerOnFullGestureEnd(
            {
                func: function (hand)
                {
                    if (action)
                    {
                        action.RegisterTranslation(pinchedObject)
                        actionManager.ActionPerformed(action);
                    }

                    pinchedObject = null;
                    action = null;
                    console.log("Gesture Ended!")
                }
            });

        pinchGesture.registerOnFullGesture(
            {
                func: function (hand)
                {
                    if (!pinchedObject)
                    {
                        pinchedObject = getPinchedObject(hand);

                        if (pinchedObject)
                        {
                            if (!action)
                            {
                                action = new TranslationAction();

                                action.Initialize(pinchedObject);
                            }

                            console.log("Pinching something!")
                        }
                    }
                    else
                    {
                        var tipPos = hand.fingers[0].tipPosition;
                        pinchedObject.position.set(tipPos[0], tipPos[1], tipPos[2]);
                    }
                }
            });

        //pinchGesture.reg
        handController.RegisterAction("PinchGesture", pinchGesture);

        //TODO: implement theo's suggestion to keep these on the body and everything else in a full-screen iframe so that these flatland sliders would work
        createAdjuster("x", -250, 250, -15, function (value) { xTranslation = value });
        createAdjuster("y", -300, 300, -75, function (value) { yTranslation = value });
        createAdjuster("z", -1000, 150, -15, function (value) { zTranslation = value });
    </script>
</body>
</html>